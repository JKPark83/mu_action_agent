# PRD-03: 시장 데이터 수집 (Market Data Collection)

> **문서 버전**: v1.0
> **작성일**: 2026-02-12
> **상태**: Draft
> **상위 문서**: PRD-00 시스템 개요
> **의존성**: PRD-01 (경매 문서 파싱 - 소재지 정보)

---

## 1. 개요

### 1.1 목적
경매 대상 부동산의 시장 가치를 파악하기 위해 실거래가, 주변 시세, 지역 시세 트렌드 등의 시장 데이터를 수집하고 분석하는 모듈을 개발한다.

### 1.2 배경
경매 물건의 적정 입찰가와 매도가를 산출하려면 해당 지역의 실제 거래 가격과 시세 동향을 정확히 파악해야 한다. 국토교통부의 실거래가 공공데이터 API를 주요 데이터 소스로 활용한다.

---

## 2. 데이터 소스

### 2.1 국토교통부 실거래가 API (주요 소스)
| API 종류 | 설명 | 데이터 |
|----------|------|--------|
| **아파트 매매 실거래가** | 아파트 매매 거래 내역 | 거래가격, 면적, 층, 거래일 |
| **아파트 전월세 실거래가** | 아파트 전월세 거래 내역 | 보증금, 월세, 면적, 거래일 |
| **연립다세대 매매 실거래가** | 빌라/연립 거래 내역 | 거래가격, 면적, 거래일 |
| **단독/다가구 매매 실거래가** | 주택 거래 내역 | 거래가격, 대지면적, 거래일 |
| **오피스텔 매매 실거래가** | 오피스텔 거래 내역 | 거래가격, 면적, 거래일 |
| **상업/업무용 실거래가** | 상가/사무실 거래 내역 | 거래가격, 면적, 거래일 |
| **토지 실거래가** | 토지 거래 내역 | 거래가격, 면적, 용도지역, 거래일 |

### 2.2 추가 데이터 소스 (확장 고려)
| 소스 | 데이터 | 활용 방법 |
|------|--------|-----------|
| **공시지가 API** | 개별공시지가, 표준지공시지가 | 토지 가치 참고 |
| **공동주택 공시가격** | 아파트 공시가격 | 시세 대비 공시가 비율 분석 |
| **건축물대장 API** | 건물 정보 | 건물 상세 정보 확인 |

---

## 3. 기능 요구사항

### 3.1 실거래가 조회
- **FR-03-001**: 경매 물건의 소재지 기반으로 해당 지역의 실거래가를 조회해야 한다
- **FR-03-002**: 최근 1년, 2년, 3년 단위로 실거래 이력을 조회할 수 있어야 한다
- **FR-03-003**: 동일 단지/건물 내 거래 이력을 우선 조회해야 한다
- **FR-03-004**: 유사 면적대(±10%)의 거래만 필터링할 수 있어야 한다

### 3.2 유사 매물 시세 분석
- **FR-03-005**: 경매 물건과 유사한 조건(면적, 층, 용도)의 최근 거래를 추출해야 한다
- **FR-03-006**: 유사 매물의 평균 거래가, 최고가, 최저가를 산출해야 한다
- **FR-03-007**: 단위 면적당 가격(㎡당, 평당)을 산출해야 한다
- **FR-03-008**: 거래 시점을 고려한 시세 보정(시간 가치 반영)을 적용해야 한다

### 3.3 시세 트렌드 분석
- **FR-03-009**: 해당 지역의 가격 변동 추이(상승/하락/보합)를 분석해야 한다
- **FR-03-010**: 월별/분기별 평균 거래가 변화를 차트 데이터로 제공해야 한다
- **FR-03-011**: 거래량 추이를 분석하여 시장 활성도를 파악해야 한다
- **FR-03-012**: 전세가율(전세가/매매가 비율)을 산출해야 한다

### 3.4 감정가 대비 시세 분석
- **FR-03-013**: 감정가와 현재 시세의 괴리율을 산출해야 한다
- **FR-03-014**: 감정 시점과 현재 시점의 시세 변동을 분석해야 한다
- **FR-03-015**: 시세 대비 최저매각가격의 할인율을 산출해야 한다

---

## 4. 데이터 모델

### 4.1 시장 데이터 분석 결과
```python
@dataclass
class MarketDataResult:
    """시장 데이터 분석 결과"""
    property_address: str               # 분석 대상 소재지
    property_type: str                  # 부동산 유형
    analysis_date: date                 # 분석 시점

    # 실거래가 분석
    recent_transactions: list[Transaction]  # 최근 거래 이력
    avg_price_per_sqm: int              # 평균 ㎡당 가격
    avg_price_per_pyeong: int           # 평균 평당 가격
    price_range: PriceRange             # 가격 범위 (최저~최고)

    # 시세 트렌드
    price_trend: PriceTrend             # 가격 추이
    volume_trend: VolumeTrend           # 거래량 추이
    jeonse_ratio: float                 # 전세가율

    # 감정가 대비 분석
    appraisal_comparison: AppraisalComparison

    # 분석 메타데이터
    data_count: int                     # 분석에 사용된 거래 건수
    data_period: str                    # 데이터 기간
    confidence_score: float             # 분석 신뢰도

@dataclass
class Transaction:
    """개별 거래 이력"""
    transaction_date: date              # 거래일
    price: int                          # 거래가격 (만원)
    area: float                         # 면적 (㎡)
    floor: int | None                   # 층 (해당 시)
    price_per_sqm: int                  # ㎡당 가격
    building_name: str | None           # 건물/단지명
    address: str                        # 소재지

@dataclass
class PriceRange:
    """가격 범위"""
    min_price: int                      # 최저 거래가
    max_price: int                      # 최고 거래가
    avg_price: int                      # 평균 거래가
    median_price: int                   # 중위 거래가

@dataclass
class PriceTrend:
    """가격 추이"""
    direction: str                      # "상승" | "하락" | "보합"
    change_rate_1y: float               # 1년간 변동률 (%)
    change_rate_6m: float               # 6개월간 변동률 (%)
    monthly_data: list[MonthlyPrice]    # 월별 데이터

@dataclass
class AppraisalComparison:
    """감정가 대비 분석"""
    appraised_value: int                # 감정가
    current_market_value: int           # 현재 추정 시세
    gap_rate: float                     # 괴리율 (%)
    minimum_bid_discount_rate: float    # 최저매각가 대비 시세 할인율 (%)
```

---

## 5. API 연동 설계

### 5.1 국토교통부 API 연동
```
기본 URL: http://openapi.molit.go.kr
인증: 공공데이터포털 API 키 (ServiceKey)
데이터 형식: XML
요청 파라미터:
  - LAWD_CD: 법정동코드 (5자리)
  - DEAL_YMD: 계약년월 (YYYYMM)
```

### 5.2 법정동코드 매핑
- 경매 물건의 소재지 주소에서 법정동코드를 추출
- 주소 → 법정동코드 변환 로직 필요
- 행정안전부 법정동코드 데이터 활용

### 5.3 데이터 수집 전략
```
1. 경매 물건 소재지에서 법정동코드 추출
       │
2. 해당 법정동의 최근 3년 실거래가 조회
   (월별로 API 호출, rate limit 고려)
       │
3. 동일 건물/단지 거래 우선 필터링
       │
4. 유사 면적대 거래 필터링
       │
5. 통계 분석 수행
   ├─ 평균/중위/최고/최저 가격
   ├─ 추이 분석
   └─ 전세가율 산출
       │
6. 분석 결과 구조화
```

---

## 6. 비기능 요구사항

- **API 호출 제한**: 공공데이터 API rate limit 준수 (일일 1,000건 등)
- **캐싱**: 동일 지역/기간 데이터 캐싱으로 API 호출 최소화
- **데이터 신선도**: 실거래가 데이터는 최대 1일 단위로 갱신
- **응답 시간**: 시장 데이터 분석 완료 60초 이내

---

## 7. 추후 상세화 필요 사항
- [ ] 공공데이터포털 API 키 발급 및 테스트
- [ ] 법정동코드 ↔ 주소 변환 로직 상세화
- [ ] API rate limit에 따른 데이터 수집 스케줄링 전략
- [ ] 캐싱 전략 상세화 (TTL, 캐시 무효화 조건)
- [ ] 부동산 유형별(아파트, 빌라, 토지 등) 분석 로직 차별화
- [ ] 시세 보정 알고리즘 상세 설계

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0 | 2026-02-12 | 초안 작성 |
| v1.1 | 2026-02-13 | MOLIT API serviceKey URL 디코딩 처리 추가. 물건 종류(아파트/다세대/다가구) 명확 구분 및 부동산 유형별 API 엔드포인트 자동 매핑 로그 추가. 월별 API 호출 진행 상황 로그 강화 |
