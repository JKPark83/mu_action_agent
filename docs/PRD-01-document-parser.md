# PRD-01: 경매 문서 파싱 (Document Parser)

> **문서 버전**: v1.0
> **작성일**: 2026-02-12
> **상태**: Draft
> **상위 문서**: PRD-00 시스템 개요

---

## 1. 개요

### 1.1 목적
사용자가 업로드한 부동산 경매 관련 PDF 문서를 파싱하여 구조화된 데이터로 변환하는 모듈을 개발한다.

### 1.2 배경
부동산 경매에서는 다양한 문서(등기부등본, 매각물건명세서, 감정평가서 등)를 분석해야 한다. 이 문서들은 PDF 형태로 제공되며, AI 분석을 위해서는 텍스트 추출 및 구조화가 선행되어야 한다.

---

## 2. 지원 문서 유형

### 2.1 필수 문서
| 문서 유형 | 설명 | 추출 대상 데이터 |
|-----------|------|-----------------|
| **등기부등본** | 소유권, 권리관계 기재 | 소유자, 갑구/을구 권리사항, 설정일자, 채권자, 채권액 |
| **매각물건명세서** | 경매 대상 물건 상세 | 물건 소재지, 용도, 면적, 점유관계, 인수할 권리 |
| **감정평가서** | 감정인의 가치 평가 | 감정가, 평가 기준, 토지/건물 가치, 개별공시지가 |

### 2.2 선택 문서
| 문서 유형 | 설명 | 추출 대상 데이터 |
|-----------|------|-----------------|
| **현황조사보고서** | 현장 조사 결과 | 점유자 정보, 임대차 관계, 현장 사진 설명 |
| **사건송달내역** | 법원 송달 기록 | 관련 당사자, 송달일자, 송달 결과 |
| **경매정보 요약** | 경매 사건 기본 정보 | 사건번호, 경매 회차, 최저매각가격, 매각기일 |

---

## 3. 기능 요구사항

### 3.1 PDF 업로드 및 관리
- **FR-01-001**: 사용자가 다수의 PDF 파일을 동시에 업로드할 수 있어야 한다
- **FR-01-002**: 업로드 가능한 파일 형식은 PDF로 제한한다
- **FR-01-003**: 단일 파일 최대 크기는 50MB로 제한한다
- **FR-01-004**: 한 번에 최대 10개 파일까지 업로드 가능하다

### 3.2 문서 유형 자동 분류
- **FR-01-005**: 업로드된 PDF의 내용을 기반으로 문서 유형을 자동 분류해야 한다
- **FR-01-006**: 분류 정확도 목표: 95% 이상
- **FR-01-007**: 자동 분류 실패 시 사용자가 수동으로 문서 유형을 지정할 수 있어야 한다
- **FR-01-008**: 분류 결과에 대한 신뢰도 점수를 제공해야 한다

### 3.3 텍스트 추출
- **FR-01-009**: 디지털 PDF에서 텍스트를 직접 추출할 수 있어야 한다
- **FR-01-010**: 스캔된 PDF의 경우 OCR을 통해 텍스트를 추출해야 한다
- **FR-01-011**: 표(테이블) 형태의 데이터를 구조적으로 추출해야 한다
- **FR-01-012**: 한글, 숫자, 특수문자를 정확하게 인식해야 한다

### 3.4 데이터 구조화
- **FR-01-013**: 추출된 텍스트를 문서 유형별로 정의된 스키마에 맞게 구조화해야 한다
- **FR-01-014**: 금액, 날짜, 면적 등의 데이터를 적절한 타입으로 변환해야 한다
- **FR-01-015**: 추출 결과에 대한 신뢰도 점수를 항목별로 제공해야 한다
- **FR-01-016**: LLM(Claude)을 활용하여 비정형 텍스트에서 핵심 정보를 추출해야 한다

---

## 4. 데이터 모델

### 4.1 등기부등본 추출 스키마
```python
@dataclass
class RegistryExtraction:
    """등기부등본 추출 데이터"""
    property_address: str           # 소재지
    property_type: str              # 부동산 유형 (아파트, 토지 등)
    area: float                     # 면적 (㎡)
    owner: str                      # 현 소유자
    ownership_history: list         # 소유권 변동 이력

    # 갑구 (소유권 관련)
    section_a_entries: list[RightEntry]  # 갑구 사항

    # 을구 (소유권 이외의 권리)
    section_b_entries: list[RightEntry]  # 을구 사항

@dataclass
class RightEntry:
    """권리 항목"""
    order: int                      # 순위번호
    registration_date: date         # 접수일자
    registration_number: str        # 접수번호
    right_type: str                 # 권리 종류 (근저당, 전세권, 가압류 등)
    right_holder: str               # 권리자
    amount: int | None              # 채권액/설정액
    details: str                    # 상세 내용
```

### 4.2 감정평가서 추출 스키마
```python
@dataclass
class AppraisalExtraction:
    """감정평가서 추출 데이터"""
    appraised_value: int            # 감정가
    appraisal_date: date            # 감정일
    land_value: int                 # 토지 평가액
    building_value: int             # 건물 평가액
    land_area: float                # 토지 면적
    building_area: float            # 건물 면적
    land_unit_price: int            # 토지 단가
    official_land_price: int        # 개별공시지가
    appraisal_notes: str            # 감정 특이사항
```

### 4.3 매각물건명세서 추출 스키마
```python
@dataclass
class SaleItemExtraction:
    """매각물건명세서 추출 데이터"""
    case_number: str                # 사건번호
    property_address: str           # 소재지
    property_description: str       # 물건 표시
    occupancy_info: list[OccupancyInfo]  # 점유관계
    assumed_rights: list[str]       # 인수할 권리
    special_conditions: list[str]   # 특별매각조건

@dataclass
class OccupancyInfo:
    """점유 관계 정보"""
    occupant: str                   # 점유자
    occupancy_type: str             # 점유 유형 (소유자, 임차인 등)
    lease_deposit: int | None       # 보증금
    monthly_rent: int | None        # 월세
    move_in_date: date | None       # 전입일
    is_opposable: bool | None       # 대항력 유무
```

---

## 5. 기술 구현 방향

### 5.1 PDF 파싱 라이브러리
- **1차**: `pdfplumber` - 텍스트 및 테이블 추출에 강점
- **2차**: `PyPDF2` - 기본적인 텍스트 추출
- **OCR**: `pytesseract` + `Pillow` - 스캔 문서용

### 5.2 LLM 기반 정보 추출
- Claude API를 활용하여 비정형 텍스트에서 구조화된 데이터 추출
- 문서 유형별 특화된 프롬프트 템플릿 사용
- JSON 스키마 기반 출력 포맷 강제

### 5.3 처리 파이프라인
```
PDF 업로드 → 텍스트 추출 → 문서 유형 분류 → LLM 기반 구조화 → 검증 → 저장
```

---

## 6. 비기능 요구사항

- **성능**: 단일 문서 파싱 10초 이내
- **정확도**: 핵심 필드(금액, 날짜, 면적) 추출 정확도 95% 이상
- **지원 형식**: PDF (디지털 및 스캔본)
- **언어**: 한국어 전용

---

## 7. 추후 상세화 필요 사항
- [ ] 각 문서 유형별 상세 파싱 규칙 정의
- [ ] OCR 정확도 향상을 위한 전처리 로직 상세화
- [ ] 파싱 실패 시 fallback 전략 상세화
- [ ] LLM 프롬프트 템플릿 상세 설계
- [ ] 파싱 결과 검증 로직 상세화

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0 | 2026-02-12 | 초안 작성 |
| v1.1 | 2026-02-13 | auction_summary(경매 포털 종합 문서) 유형 추가. 탱크옥션/지지옥션 등 경매 포털에서 출력한 복합문서를 단일 PDF로 업로드 시 등기부/감정/매각 정보를 동시 추출하는 기능 |
